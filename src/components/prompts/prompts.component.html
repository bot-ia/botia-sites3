
<div class="animate-fade-in">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-slate-900 dark:text-white">{{ languageService.T('promptConfig') }}</h1>
    <button (click)="openModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center shadow hover:shadow-lg">
      <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
      {{ languageService.T('newPrompt') }}
    </button>
  </div>

  @if (isLoading()) {
    <div class="text-center p-8 text-slate-500 dark:text-slate-400">{{ languageService.T('loadingPrompts') }}</div>
  } @else {
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-md border border-slate-200 dark:border-slate-700 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-left">
          <thead class="bg-slate-50 dark:bg-slate-900/70 text-sm text-slate-500 dark:text-slate-400">
            <tr>
              <th class="p-4 font-semibold">{{ languageService.T('promptId') }}</th>
              <th class="p-4 font-semibold">{{ languageService.T('contentPreview') }}</th>
              <th class="p-4 font-semibold">{{ languageService.T('createdAt') }}</th>
              <th class="p-4 font-semibold text-right">{{ languageService.T('actions') }}</th>
            </tr>
          </thead>
          <tbody>
            @for (prompt of prompts(); track prompt.id) {
              <tr class="border-t border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors duration-150">
                <td class="p-4 font-mono text-indigo-500 dark:text-indigo-400">{{ prompt.promptId }}</td>
                <td class="p-4 text-slate-600 dark:text-slate-300 max-w-md truncate">{{ prompt.content }}</td>
                <td class="p-4 text-slate-500 dark:text-slate-400">{{ formatDate(prompt.createdAt) }}</td>
                <td class="p-4 text-right">
                  <button (click)="openModal(prompt)" class="text-blue-500 hover:text-blue-400 mr-4">{{ languageService.T('edit') }}</button>
                  <button (click)="deletePrompt(prompt.id)" class="text-red-500 hover:text-red-400">{{ languageService.T('delete') }}</button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="4" class="text-center p-8 text-slate-500">{{ languageService.T('noPromptsFound') }}</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>

<!-- Modal -->
@if (isModalOpen() && editingPrompt()) {
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-8 w-full max-w-3xl border border-slate-200 dark:border-slate-700 animate-pop-in">
      <h2 class="text-2xl font-bold mb-6 text-slate-900 dark:text-white">{{ languageService.T(editingPrompt()!.id ? 'editPrompt' : 'createPrompt') }}</h2>
      
      <form #promptForm="ngForm" (ngSubmit)="savePrompt()">
        <div class="mb-4">
          <label for="promptId" class="block text-slate-600 dark:text-slate-300 font-semibold mb-2">{{ languageService.T('promptIdLabel') }}</label>
          <input type="text" id="promptId" name="promptId" #promptId="ngModel" [(ngModel)]="editingPrompt()!.promptId"
                 class="w-full bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white rounded-md p-3 border border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none font-mono"
                 [placeholder]="languageService.T('promptIdPlaceholder')" required>
        </div>
        
        <div class="mb-6">
          <label for="promptContent" class="block text-slate-600 dark:text-slate-300 font-semibold mb-2">{{ languageService.T('promptContentLabel') }}</label>
          <div class="bg-slate-200 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg">
            <div class="p-2 border-b border-slate-300 dark:border-slate-700 flex items-center gap-2 flex-wrap">
                <span class="text-sm text-slate-500 dark:text-slate-400 mr-2">{{ languageService.T('insertVariable') }}</span>
                <button type="button" (click)="insertVariable('user_name', promptContentRef)" class="px-2 py-1 text-xs bg-slate-300 dark:bg-slate-700 hover:bg-slate-400 dark:hover:bg-slate-600 rounded">user_name</button>
                <button type="button" (click)="insertVariable('order_id', promptContentRef)" class="px-2 py-1 text-xs bg-slate-300 dark:bg-slate-700 hover:bg-slate-400 dark:hover:bg-slate-600 rounded">order_id</button>
                <button type="button" (click)="insertVariable('product_name', promptContentRef)" class="px-2 py-1 text-xs bg-slate-300 dark:bg-slate-700 hover:bg-slate-400 dark:hover:bg-slate-600 rounded">product_name</button>
            </div>
            <textarea id="promptContent" name="promptContent" #promptContentRef #promptContent="ngModel" [(ngModel)]="editingPrompt()!.content"
                      class="w-full bg-transparent text-slate-800 dark:text-white rounded-b-md p-3 h-64 resize-y focus:outline-none"
                      [placeholder]="languageService.T('promptContentPlaceholder')" required></textarea>
          </div>
        </div>
        
        <div class="flex justify-end gap-4">
          <button type="button" (click)="closeModal()" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-600 dark:hover:bg-slate-700 text-slate-800 dark:text-white font-bold py-2 px-4 rounded-lg transition-colors">{{ languageService.T('cancel') }}</button>
          <button type="submit" [disabled]="promptForm.invalid" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg disabled:bg-slate-400 dark:disabled:bg-slate-500 disabled:cursor-not-allowed transition-colors">{{ languageService.T('savePrompt') }}</button>
        </div>
      </form>
    </div>
  </div>
}